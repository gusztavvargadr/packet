version: '3'

services:
  build-consul:
    build:
      context: ./
      dockerfile: ./build/docker/consul.Dockerfile

    volumes:
      - ./.consul/data/:/consul/data/

    ports:
      - "8500:8500"

  sample-device-linux:
    build:
      context: ./
      dockerfile: ./build/docker/sample.Dockerfile
      args:
        name: device-linux

    volumes:
      - ./samples/device-linux/.terraform/:/opt/gusztavvargadr/packet/samples/device-linux/.terraform/

    environment:
      PACKET_AUTH_TOKEN: '${PACKET_AUTH_TOKEN:-packet-auth-token}'
      CONSUL_HTTP_ADDR: '${CONSUL_HTTP_ADDR:-build-consul:8500}'

  sample-device-windows:
    build:
      context: ./
      dockerfile: ./build/docker/sample.Dockerfile
      args:
        name: device-windows

    volumes:
      - ./samples/device-windows/.terraform/:/opt/gusztavvargadr/packet/samples/device-windows/.terraform/

    environment:
      PACKET_AUTH_TOKEN: '${PACKET_AUTH_TOKEN:-packet-auth-token}'
      CONSUL_HTTP_ADDR: '${CONSUL_HTTP_ADDR:-build-consul:8500}'
